---
import BaseLayout from "../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

const posts = await getCollection("news");
const latest = posts
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 3);
---

<BaseLayout
  title="Eagle Quarter Newbury - Redevelopment Updates, News & Information"
  description="Independent information site covering the Eagle Quarter Newbury redevelopment, including news, planning updates and local context."
  ogImage="/images/og/home.jpg"
  >
  <section>
    <h1>Eagle Quarter Newbury - Redevelopment Updates, News & Information</h1>
    <p class="muted">
      Eagle Quarter is a major mixed-use redevelopment in Newbury, Berkshire.
      This independent site provides up-to-date information, planning context,
      news, and local insight into the Eagle Quarter Newbury development.
    </p>
  </section>

  <section>
    <h2>Latest News</h2>
  </section>

  <section class="hero-carousel">
    {latest.slice(0,3).map((post, index) => (
      <a
        href={`/news/${post.slug}/`} 
        class={`carousel-card ${index === 0 ? "active" : ""}`}
        data-index={index}
      >
        <img
          src={post.data.heroImage}
          alt={post.data.title}
          class="carousel-image"
        />
        <div class="carousel-overlay">
          <h2>{post.data.title}</h2>
        </div>
      </a>
    ))}
  </section>

  <section>
    <nav class="pagination">
      <a href="/news/page/1/">View all news →</a>
    </nav>
  </section>

  <section>
    <h2>What is Eagle Quarter Newbury?</h2>
    <p>
      Eagle Quarter is a significant regeneration project located in central
      Newbury, within the West Berkshire Council area. The development forms part
      of a wider strategy to revitalise Newbury town centre through modern
      commercial, residential and public space.
    </p>

    <div class="info-grid">
      <a href="/eagle-quarter-newbury-development/" class="card">
            <img
              src="/images/pages/investment-hero.jpg"
              alt=""
              loading="lazy"
              class="card-image"
            />
        <div class="card-body">
          <strong>Mixed-use development</strong>
          <p class="muted">Retail, residential, commercial and public realm</p>
        </div>
      </a>

      <a href="/eagle-quarter-newbury-location/" class="card">
            <img
              src="/images/pages/location-hero.jpg"
              alt=""
              loading="lazy"
              class="card-image"
            />
        <div class="card-body">
          <strong>Town-centre location</strong>
          <p class="muted">Close to transport, retail and amenities</p>
        </div>
      </a>

      <a href="/eagle-quarter-newbury-planning-permission/" class="card">
            <img
              src="/images/pages/home-hero.jpg"
              alt=""
              loading="lazy"
              class="card-image"
            />
        <div class="card-body">
          <strong>Regeneration focus</strong>
          <p class="muted">Part of Newbury’s long-term growth strategy</p>
        </div>
      </a>
    </div>
  </section>

  <section>
    <h2>Location & Connectivity</h2>
    <p>
      Eagle Quarter is located in Newbury, Berkshire, close to Newbury Station
      and major road links including the A339 and A4. The site benefits from
      strong regional and commuter connectivity.
    </p>

    <iframe
      loading="lazy"
      referrerpolicy="no-referrer-when-downgrade"
      src="https://www.google.com/maps?q=Eagle+Quarter+Newbury&output=embed"
      style="width:100%;height:360px;border:0;">
    </iframe>
  </section>

  <section>
    <h2>Development Status & Timeline</h2>
    <p>
      Eagle Quarter Newbury is progressing through planning and development
      phases typical of large regeneration schemes. This site tracks planning
      applications, public announcements and construction milestones as
      information becomes available.
    </p>
  </section>

  <section>
    <h2>Independent Information Resource</h2>
    <p>
      This website is an independent informational resource and is not affiliated
      with the developers, landowners or investors behind Eagle Quarter. Content
      is compiled from publicly available sources for research and reference.
    </p>
  </section>

  <script>
    const container = document.querySelector<HTMLDivElement>('.hero-carousel')!;

    let cards = Array.from(container.children) as HTMLElement[];

    function rotate() {
      if (cards.length === 0) return;
      container.appendChild(cards[0]);
      cards = Array.from(container.children) as HTMLElement[];
    }

    cards.forEach(card => {
      card.addEventListener('click', (e) => {
        const frontCard = cards[0];
        if (card !== frontCard) {
          e.preventDefault();
          rotate();
        }
      });
    });

    let startX = 0;

    container.addEventListener('touchstart', (e: TouchEvent) => {
      startX = e.touches[0].clientX;
    });

    container.addEventListener('touchend', (e: TouchEvent) => {
      const diff = e.changedTouches[0].clientX - startX;
      if (diff < -50) rotate();
    });
  </script>

</BaseLayout>
