---
import BaseLayout from "../../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
  const posts = await getCollection("news");
  const PAGE_SIZE = 6;
  const totalPages = Math.ceil(posts.length / PAGE_SIZE);

  return Array.from({ length: totalPages }).map((_, i) => ({
    params: { page: String(i + 1) },
  }));
}

const { page } = Astro.params;
const currentPage = Number(page);
const PAGE_SIZE = 9;

const allPosts = await getCollection("news");
const sorted = allPosts.sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

const totalPages = Math.ceil(sorted.length / PAGE_SIZE);

const posts = sorted.slice(
  (currentPage - 1) * PAGE_SIZE,
  currentPage * PAGE_SIZE
);
---
<BaseLayout
  title={`News – Page ${page}`}
  description={`Eagle Quarter Newbury news archive – page ${page}`}
>
  <h1>Eagle Quarter Newbury News - Page {page}</h1>

    <div class="info-grid">
      {posts.map((post) => (
        <a href={`/news/${post.slug}/`} class="news-card">
          {post.data.heroImage && (
            <img
              src={post.data.heroImage}
              alt=""
              loading="lazy"
              class="news-card-image"
            />
          )}
      <div class="news-card-body">
        <strong>{post.data.title}</strong>
        <p class="muted">{post.data.description}</p>
      </div>
    </a>
      ))}
    </div>

      <nav class="pagination">
    {currentPage > 1 && (
      <a rel="prev" href={`/news/page/${currentPage - 1}/`}>
        ← Newer posts
      </a>
    )}

    {currentPage < totalPages && (
      <a rel="next" href={`/news/page/${currentPage + 1}/`}>
        Older posts →
      </a>
    )}
  </nav>
<p>Page {page} of {totalPages}</p>
<!-- <p>Posts on this page: {posts.length}</p> -->

</BaseLayout>